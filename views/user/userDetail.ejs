<%- include('./userLayout/header') %>
 
        <header class="header-area header-style-1 header-height-2">
            <div class="header-top header-top-ptb-1 d-none d-lg-block">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-xl-3 col-lg-4">
                            <div class="header-info header-info-right">
                                <ul>
                                    <% if (user) { %>
                                        <li><a href="/userDetail"><%=user.name%></a></li>
    
                                        <li><a href="/userLogout">Logout</a></li>
    
                                        <% }else{%>
                                            <li><i class="fi-rs-user"></i><a href="/login">Log In</a></li>
                                      <%  } %>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <div class="header-bottom sticky-bar sticky-white-bg">
            <div class="container">
                <div class="header-wrap header-space-between position-relative">
                    <div class="logo logo-width-1">
                        <a href="index.html"><img src="/productImages/logoimages.png" alt="logo"></a>
                    </div>
                    <div
                        class="main-menu main-menu-grow main-menu-padding-1 main-menu-lh-1 main-menu-mrg-1 hm3-menu-padding d-none d-lg-block hover-boder">
                        <nav>
                            <ul>
                                <li><a  href="/">Home</a>

                                </li>
                                <li><a href="/shop">Shop</a>

                                </li>
                                <li>
                                    <a href="/about">About</a>
                                </li>


                                <li>
                                    <a href="/contact">Contact</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    <div class="header-action-right">
                        <div class="search-style-2">

                        </div>
                        <div class="header-action-2">
                            <div class="header-action-icon-2">
                                <a href="/wishlist">
                                    <img class="svgInject" alt="Evara" src="assets/imgs/theme/icons/icon-heart.svg">

                                </a>
                            </div>
                            <div class="header-action-icon-2">
                                <a class="mini-cart-icon" href="/cart">
                                    <img alt="Evara" src="assets/imgs/theme/icons/icon-cart.svg">

                                </a>

                            </div>
                            <div class="header-action-icon d-block d-lg-none">
                                <div class="burger-icon">
                                    <span class="burger-icon-top"></span>
                                    <span class="burger-icon-mid"></span>
                                    <span class="burger-icon-bottom"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="mobile-header-active mobile-header-wrapper-style">
        <div class="mobile-header-wrapper-inner">
            <div class="mobile-header-top">
                <div class="mobile-header-logo">
                    <a href="index.html"><img src="/productImages/logoimages.png" alt="logo"></a>
                </div>
                <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                    <button class="close-style search-close">
                        <i class="icon-top"></i>
                        <i class="icon-bottom"></i>
                    </button>
                </div>
            </div>
            <div class="mobile-header-content-area">
                <div class="mobile-search search-style-3 mobile-header-border">
                    <form action="#">
                        <input type="text" placeholder="Search for itemsâ€¦">
                        <button type="submit"><i class="fi-rs-search"></i></button>
                    </form>
                </div>
                <div class="mobile-menu-wrap mobile-header-border">
                </div>
                <!-- mobile menu start -->
                <nav>
                    <ul class="mobile-menu">
                        <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                href="index.html">Home</a>

                        </li>
                        <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                href="shop-grid-right.html">shop</a>

                        </li>



                    </ul>
                </nav>
                <!-- mobile menu end -->
            </div>
            <div class="mobile-header-info-wrap mobile-header-border">
                <div class="single-mobile-header-info mt-30">
                    <a href="page-contact.html"> Our location </a>
                </div>
                <div class="single-mobile-header-info">
                    <a href="page-login-register.html">Log In / Sign Up </a>
                </div>
                <div class="single-mobile-header-info">
                    <a href="#">(+01) - 2345 - 6789 </a>
                </div>
            </div>
            <div class="mobile-social-icon">
                <h5 class="mb-15 text-grey-4">Follow Us</h5>
                <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
            </div>
        </div>
    </div>
    </div>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Pages
                    <span></span> Account
                </div>
            </div>
        </div>
        <section class="pt-150 pb-150">
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 m-auto">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                                href="#dashboard" role="tab" aria-controls="dashboard"
                                                aria-selected="false"><i
                                                    class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" 
                                                href="/accountDetail" 
                                                ><i class="fi-rs-user mr-10"></i>Account details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link"  href="/userAddress"
                                                ><i class="fi-rs-marker mr-10"></i>My Address</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link"  href="/wallet"
                                                ><i
                                                    class="fi-rs-shopping-bag mr-10"></i>Wallet</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link"  href="/userOrder"
                                                ><i
                                                    class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                        </li>
                                      
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="tab-content dashboard-content">
                                    <% if (user) { %>
                                        <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                            aria-labelledby="dashboard-tab">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Hello <%= user.name %>
                                                    </h5>
                                                </div>
                                                <div class="card-body">
                                                    <p>From your account dashboard, you can easily check & view your <a
                                                            href="#">recent orders</a>, manage your <a href="#">shipping
                                                            and billing addresses</a>, and <a href="#">edit your
                                                            password and account details</a>.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md">
                                            <article class="box m-3 bg-light d-flex">
                                              <h5>Referral Code </h5> :<h5>
                                                <%=referralCode%>
                                              </h5>
                                            </article>
                                         
                                          </div> 
                                        <% } %>

                                            
                                            

                                            
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </section>
    </main>
    


    <script>
        var addressForm = document.getElementById("addressForms");
        var name = document.getElementById("name");
        var housename = document.getElementById("housename");
        var street = document.getElementById("street");
        var city = document.getElementById("city");
        var district = document.getElementById("district");
        var state = document.getElementById("state");
        var pincode = document.getElementById("pincode");
        var phonenumber = document.getElementById("phonenumber");
        var altPhone = document.getElementById("altPhone");

        var housenameError = document.getElementById("housenameError");
        var streetError = document.getElementById("streetError");
        var cityError = document.getElementById("cityError");
        var districtError = document.getElementById("districtError");
        var stateError = document.getElementById("stateError");
        var pincodeError = document.getElementById("pincodeError");
        var phonenumberError = document.getElementById("phonenumberError");
        var altPhoneError = document.getElementById("altPhoneError");
        var nameError = document.getElementById("nameError");


        var phNu_check = /^\d{10}$/;

        addressForm.addEventListener('submit', (e) => {
            if (name.value.trim() === '') {
                e.preventDefault();
                nameError.innerHTML = "Name is required";
            } else {
                nameError.innerHTML = "";
            }

            if (housename.value.trim() === '') {
                e.preventDefault();
                housenameError.innerHTML = "housename is required";
            } else {
                housenameError.innerHTML = "";
            }

            if (street.value.trim() === '') {
                e.preventDefault();
                streetError.innerHTML = "street is required";
            } else {
                streetError.innerHTML = "";
            }

            if (city.value.trim() === '') {
                e.preventDefault();
                cityError.innerHTML = "city is required";
            } else {
                cityError.innerHTML = "";
            }

            if (district.value.trim() === '') {
                e.preventDefault();
                districtError.innerHTML = "district is required";
            } else {
                districtError.innerHTML = "";
            }

            if (state.value.trim() === '') {
                e.preventDefault();
                stateError.innerHTML = "state is required";
            } else {
                stateError.innerHTML = "";
            }

            if (pincode.value.trim() === '') {
                e.preventDefault();
                pincodeError.innerHTML = "pincode is required";
            } else {
                pincodeError.innerHTML = "";
            }

            var phonenumber = phonenumberInput.value.trim();
            if (phonenumber === '0000000000') {
                e.preventDefault();
                phonenumberError.innerHTML = "Please enter a valid phone number other than all zeros";
            } else if (!phonenumber.match(phNu_check)) {
                e.preventDefault();
                phonenumberError.innerHTML = "Please enter a valid 10-digit phone number";
            } else {
                phonenumberError.innerHTML = "";
            }

            var altPhone = altPhoneInput.value.trim();
            if (altPhone === '0000000000') {
                e.preventDefault();
                altPhoneError.innerHTML = "Please enter a valid phone number other than all zeros";
            } else if (!altPhone.match(phNu_check)) {
                e.preventDefault();
                altPhoneError.innerHTML = "Please enter a valid 10-digit phone number";
            } else {
                altPhoneError.innerHTML = "";
            }

        });
    </script>

    <script>
        function confirmAddAddress(addressId) {
            Swal.fire({
                title: 'Are you sure?',
                text: 'Do you want to add address?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.isConfirmed) {
                    openAddAddressModal();
                }
            });
        }

        $(document).ready(function () {
            $("#addressForms").click(function () {
                $("#addressType").val("");
                $("#name").val("");
                $("#housename").val("");
                $("#street").val("");
                $("#city").val("");
                $("#district").val("");
                $("#state").val("");
                $("#pincode").val("");
                $("#phonenumber").val("");
                $("#altPhone").val("");
            });

            $("#saveAddress").click(function () {
                saveAddress();
            });
        });

        function openAddAddressModal() {

            $("#addressType").val("");
            $("#name").val("");
            $("#housename").val("");
            $("#street").val("");
            $("#city").val("");
            $("#district").val("");
            $("#state").val("");
            $("#pincode").val("");
            $("#phonenumber").val("");
            $("#altPhone").val("");


            $('#addAddressModal').modal('show');
        }

        function confirmSaveAddress() {
            Swal.fire({
                title: 'Success',
                text: 'Address has been saved',
                icon: 'success',
            }).then((result) => {
                if (result.isConfirmed) {
                    saveAddress();
                }
            });
        }

        function saveAddress() {
            const addressType = $('input[name="addressType"]:checked').val();
            const name = $('#name').val();
            const housename = $('#housename').val();
            const street = $('#street').val();
            const city = $('#city').val();
            const district = $('#district').val();
            const state = $('#state').val();
            const pincode = $('#pincode').val();
            const phonenumber = $('#phonenumber').val();
            const altPhone = $('#altPhone').val();

            const newAddress = {
                addressType: addressType,
                name: name,
                housename: housename,
                street: street,
                city: city,
                district: district,
                state: state,
                pincode: pincode,
                phonenumber: phonenumber,
                altPhone: altPhone
            };

            $.ajax({
                url: '/saveAddress',
                method: 'POST',
                data: newAddress,
                success: function (response) {
                    window.location.href = '/userDetail';
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });


            $('#addAddressModal').modal('hide');
        }


        function confirmEditAddressModal(addressId) {
            Swal.fire({
                title: 'Are you sure?',
                text: 'Do you want to edit this address?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.isConfirmed) {
                    console.log('user say yess to edit the address')
                    openEditAddressModal(addressId);
                }
            });
        }


        function openEditAddressModal(addressId) {

            $.ajax({

                url: `/editaddress/${addressId}`,
                method: 'GET',
                success: function (response) {
                    if (response && response.success) {

                        $('#editAddressType').val(response.addressType);
                        $('#editName').val(response.name);
                        $('#editHousename').val(response.housename);
                        $('#editStreet').val(response.street);
                        $('#editCity').val(response.city);
                        $('#editDistrict').val(response.district);
                        $('#editState').val(response.state);
                        $('#editPincode').val(response.pincode);
                        $('#editPhonenumber').val(response.phonenumber);
                        $('#editAltPhone').val(response.altPhone);


                        $('#editAddressId').val(addressId);


                        $('#editAddressModal').modal('show');
                    } else {

                        console.error('Error retrieving address data:', response.error);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error retrieving address data:', error);
                }
            });
        }




    </script>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <%- include('./userLayout/footer') %>