<%- include('./adminLayout/header') %>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="index.html" class="brand-wrap">
                <img src="/productImages/logoimages.png" class="logo" alt="Evara Dashboard">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i>
                </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item active">
                    <a class="menu-link" href="index.html"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/product"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/categorylist"> <i class="icon material-icons md-store"></i>
                        <span class="text">Category</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/Userlist"> <i class="icon material-icons md-add_box"></i>
                        <span class="text">User</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/orderlist"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Orders</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/couponList"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Coupon</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/offerList"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Offers</span>
                    </a>
                </li>
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
                <form class="searchform">
                    <datalist id="search_terms">
                        <option value="Products">
                        <option value="New orders">
                        <option value="Apple iphone">
                        <option value="Ahmed Hassan">
                    </datalist>
                </form>
            </div>
            <div class="col-nav">
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i
                        class="material-icons md-apps"></i> </button>
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link btn-icon" href="#">
                            <i class="material-icons md-notifications animation-shake"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="requestfullscreen nav-link btn-icon"><i
                                class="material-icons md-cast"></i></a>
                    </li>
                    <li class="dropdown nav-item">
                        <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                            aria-expanded="false"> <img class="img-xs rounded-circle"
                                src="/admin-assets/imgs/people/avatar2.jpg" alt="User"></a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                            <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit
                                Profile</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account
                                Settings</a>
                            <a class="dropdown-item" href="#"><i
                                    class="material-icons md-account_balance_wallet"></i>Wallet</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-receipt"></i>Billing</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help
                                center</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href="/admin/adminLogout"><i
                                    class="material-icons md-exit_to_app"></i>Logout</a>
                        </div>
                    </li>
                </ul>
            </div>
        </header>
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Dashboard </h2>
                    <p>Whole data about your business here</p>
                </div>
                <div>
                    <a href="/admin/salesReport" class="btn btn-primary"><i
                            class="text-muted material-icons md-post_add"></i>Create report</a>
                </div>
            </div>
            <div class="row">
                <% if(product&&order&&category&&user){ %>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-primary-light"><i
                                        class="text-primary material-icons md-monetization_on"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Revenue</h6>
                                    <% var sum=0 %>
                                        <% for( let i=0; i < order.length; i++ ) { %>
                                            <% sum+=order[i].totalAmount %>
                                                <% } %>
                                                    <span> &#8377; <%= sum %></span>
                                                    <span class="text-sm">
                                                        Total Revenue Here
                                                    </span>
                                </div>
                            </article>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-success-light"><i
                                        class="text-success material-icons md-local_shipping"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Orders</h6> <span>
                                        <%= order.length %>
                                    </span>
                                    <span class="text-sm">
                                        All Order here
                                    </span>
                                </div>
                            </article>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-warning-light"><i
                                        class="text-warning material-icons md-qr_code"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Products</h6> <span>
                                        <%=product.length %>
                                    </span>
                                    <span class="text-sm">
                                        In <%=category.length %> Categories
                                    </span>
                                </div>
                            </article>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-info-light"><i
                                        class="text-info material-icons md-shopping_basket"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">User</h6> <span>
                                        <%=order.length %>
                                    </span>
                                    <span class="text-sm">
                                        Based on your orders.
                                    </span>
                                </div>
                            </article>
                        </div>
                    </div>
                    <% } %>
            </div>
            <div class="row">
                <div class="col-xl-8 col-lg-12">
                    <div class="card mb-4">
                        <article class="card-body">
                            <h5 class="card-title">Sale statistics</h5>
                            <div>
                                <label for="filter">Filter:</label>
                                <select id="filter" onchange="updateChart()">
                                    <option value="monthly">Monthly</option>
                                    <option value="weekly">Weekly</option>
                                </select>
                            </div>
                            <canvas id="myChart1" height="120px"></canvas>
                        </article>
                    </div>
                </div>
            </div>

            <script>
                window.onload = () => {
                    const totalOrdersJson = <%=totalOrdersJson%>;
                    const totalProductsJson = <%=totalProductsJson%>;
                    const totalRegisterJson = <%=totalRegisterJson%>;

                    const totalOrdersWeeklyJson = <%=totalOrdersWeeklyJson%>;
                    const totalProductsWeeklyJson = <%=totalProductsWeeklyJson%>;
                    const totalRegisterWeeklyJson = <%=totalRegisterWeeklyJson%>;
                
                    const monthlyData = {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [
                            {
                                label: 'Users',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(44, 120, 220, 0.2)',
                                borderColor: 'rgba(44, 120, 220)',
                                data: totalRegisterJson
                            },
                            {
                                label: 'Products',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(4, 209, 130, 0.2)',
                                borderColor: 'rgb(4, 209, 130)',
                                data: totalProductsJson
                            },
                            {
                                label: 'Orders',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(255, 200, 230, 0.2)',
                                borderColor: 'rgb(255, 200, 230)',
                                data: totalOrdersJson
                            }
                        ]
                    };

                    const weeklyData = {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8', 'Week 9', 'Week 10', 'Week 11', 'Week 12', 'Week 13', 'Week 14', 'Week 15', 'Week 16', 'Week 17', 'Week 18', 'Week 19', 'Week 20', 'Week 21', 'Week 22', 'Week 23', 'Week 24', 'Week 25', 'Week 26', 'Week 27', 'Week 28', 'Week 29', 'Week 30', 'Week 31', 'Week 32', 'Week 33', 'Week 34', 'Week 35', 'Week 36', 'Week 37', 'Week 38', 'Week 39', 'Week 40', 'Week 41', 'Week 42', 'Week 43', 'Week 44', 'Week 45', 'Week 46', 'Week 47', 'Week 48', 'Week 49', 'Week 50', 'Week 51', 'Week 52'],
                        datasets: [
                            {
                                label: 'Users',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(44, 120, 220, 0.2)',
                                borderColor: 'rgba(44, 120, 220)',
                                data: totalRegisterWeeklyJson
                            },
                            {
                                label: 'Products',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(4, 209, 130, 0.2)',
                                borderColor: 'rgb(4, 209, 130)',
                                data: totalProductsWeeklyJson
                            },
                            {
                                label: 'Orders',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(255, 200, 230, 0.2)',
                                borderColor: 'rgb(255, 200, 230)',
                                data: totalOrdersWeeklyJson
                            }
                        ]
                    };

                    var ctx = document.getElementById('myChart1').getContext('2d');
                    var chart = new Chart(ctx, {
                        type: 'line',
                        data: monthlyData,
                        options: {
                            plugins: {
                                legend: {
                                    labels: {
                                        usePointStyle: true,
                                    },
                                }
                            }
                        }
                    });
                    window.updateChart = function () {
                        const filter = document.getElementById('filter').value;
                        if (filter === 'weekly') {
                            chart.data = weeklyData;
                        } else {
                            chart.data = monthlyData;
                        }
                        chart.update();
                    }
                }
            </script>
            </div>
            </div>
            <div class="card mb-4">
                <header class="card-header">
                    <h4 >Latest orders</h4>
                    
                </header>
                <div class="card-body">
                    <div class="table-responsive">
                        <div class="table-responsive">
                            <%if(order){%>
                                <table class="table align-middle table-nowrap mb-0" id="myTable">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col" class="text-center">
                                                <div class="form-check align-middle">
                                                    <input class="form-check-input" type="checkbox"
                                                        id="transactionCheck01">
                                                    <label class="form-check-label" for="transactionCheck01"></label>
                                                </div>
                                            </th>
                                            <th class="align-middle" scope="col">Order ID</th>
                                            <th class="align-middle" scope="col">Billing Name</th>
                                            <th class="align-middle" scope="col">Date</th>
                                            <th class="align-middle" scope="col">Total</th>
                                            <th class="align-middle" scope="col">Payment Status</th>
                                            <th class="align-middle" scope="col">Payment Method</th>
                                            <th class="align-middle" scope="col">View Details</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% for( let i=order.length-1; i>=0; i-- ) { %>
                                            <tr>


                                                <td class="text-center">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox"
                                                            id="transactionCheck02">
                                                        <label class="form-check-label"
                                                            for="transactionCheck02"></label>
                                                    </div>
                                                </td>
                                                <td><a href="#" class="fw-bold">
                                                        <%=order[i].orderId %>
                                                    </a> </td>
                                                <td>
                                                 
                                                </td>
                                                <td>
                                                    <%= order[i].orderDate.toLocaleString() %>
                                                </td>
                                                <td>
                                                    <%=order[i].totalAmount %>
                                                </td>
                                                <td>
                                                    <span class="badge badge-pill badge-soft-success">
                                                        <%=order[i].paymentStatus%>
                                                    </span>
                                                </td>
                                                <td>
                                                    <i class="material-icons md-payment font-xxl text-muted mr-5"></i>
                                                    <%=order[i].paymentMethod%>
                                                </td>
                                                <td>
                                                    <a href="/admin/orderDetail?orderId=<%=order[i]._id %>"
                                                        class="btn btn-xs"> View details</a>
                                                </td>
                                            </tr>
                                            <% } %>
                                    </tbody>
                                </table>
                                <% } %>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">

                            <div class="text">
                                <h6 class="mb-1 card-title">Top Selling Category</h6>
                                <% for (let i=0; i < Math.min(5, category.length); i++) { %>
                                    <li>
                                        <a>
                                            <%= category[i].name %>
                                        </a>
                                    </li>
                                    <% } %>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <div class="text">
                                <h6 class="mb-1 card-title">Top Selling Product</h6>
                                <% for (let i=0; i < Math.min(5, product.length); i++) { %>
                                    <li>
                                        <a>
                                            <%= product[i].product_title %>
                                        </a>
                                    </li>
                                    <% } %>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
        </section> 

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="//cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>
    
        <script>
        let table = new DataTable('#myTable');
        </script>
<%- include('./adminLayout/footer') %>